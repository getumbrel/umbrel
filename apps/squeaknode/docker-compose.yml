version: "3.7"

services:
  web:
    image: yzernik/squeaknode:v0.1.135@sha256:82f16d1e0f368e2d2c4c3b4e39934dc858d5ac1ebd61f7f1258ada3d5d2c7dcf
    restart: on-failure
    stop_grace_period: 1m
    ports:
      - "$APP_SQUEAKNODE_PORT:$APP_SQUEAKNODE_PORT"
      - "$APP_SQUEAKNODE_GRPC_PORT:$APP_SQUEAKNODE_GRPC_PORT"
    volumes:
      - ${APP_DATA_DIR}/sqk:/sqk
      - ${LND_DATA_DIR}:/lnd:ro
    user: "1000:1000"
    environment:
      # Bitcoin Core connection details
      SQUEAKNODE_BITCOIN_RPC_HOST: $BITCOIN_IP
      SQUEAKNODE_BITCOIN_RPC_PORT: $BITCOIN_RPC_PORT
      SQUEAKNODE_BITCOIN_RPC_USER: $BITCOIN_RPC_USER
      SQUEAKNODE_BITCOIN_RPC_PASS: $BITCOIN_RPC_PASS
      SQUEAKNODE_BITCOIN_ZEROMQ_HASHBLOCK_PORT: $BITCOIN_ZMQ_HASHBLOCK_PORT

      # LND environment variables
      SQUEAKNODE_LND_HOST: $LND_IP
      SQUEAKNODE_LND_RPC_PORT: $LND_GRPC_PORT
      SQUEAKNODE_LND_TLS_CERT_PATH: "/lnd/tls.cert"
      SQUEAKNODE_LND_MACAROON_PATH: "/lnd/data/chain/bitcoin/$BITCOIN_NETWORK/admin.macaroon"

      # App specific environment variables
      SQUEAKNODE_WEBADMIN_ENABLED: "true"
      SQUEAKNODE_WEBADMIN_USERNAME: "umbrel"
      SQUEAKNODE_WEBADMIN_PASSWORD: "moneyprintergobrrr"

      SQUEAKNODE_NODE_NETWORK: "$BITCOIN_NETWORK"
      SQUEAKNODE_NODE_SQK_DIR_PATH: "/sqk"
      SQUEAKNODE_NODE_LND_EXTERNAL_HOST: $LND_IP
      SQUEAKNODE_NODE_MAX_SQUEAKS: 10000
      SQUEAKNODE_NODE_TOR_PROXY_IP: $TOR_PROXY_IP
      SQUEAKNODE_NODE_TOR_PROXY_PORT: $TOR_PROXY_PORT
      SQUEAKNODE_NODE_EXTERNAL_ADDRESS: $SQUEAKNODE_P2P_HIDDEN_SERVICE

      DEBUG: "squeaknode:*"

      # Tor
      # @yzernik just adding these here for your reference. Feel free to
      # remove/rename them.
      UI_HIDDEN_SERVICE: $APP_HIDDEN_SERVICE
    networks:
      default:
        ipv4_address: $APP_SQUEAKNODE_IP
