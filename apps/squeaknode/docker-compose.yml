version: "3.7"

x-logging:
  &default-logging
  driver: journald
  options:
    tag: "umbrel-app {{.Name}}"

services:
  web:
    image: yzernik/squeaknode:latest
    logging: *default-logging
    restart: on-failure
    stop_grace_period: 1m
    ports:
      # Replace <port> with the port that your app's web server
      # is listening inside the Docker container. If you need to
      # expose more ports, add them below.
      - 8774:8774
      # - 8994:8994
      - 12994:12994
    volumes:
      # Uncomment to mount your data directories inside
      # the Docker container for storing persistent data
      - ${APP_DATA_DIR}/sqk:/sqk
      # - ${APP_DATA_DIR}/bar:/bar

      # Uncomment to mount LND's data directory as read-only
      # inside the Docker container at path /lnd
      - ${LND_DATA_DIR}:/lnd:ro

      # Uncomment to mount Bitcoin Core's data directory as
      # read-only inside the Docker container at path /bitcoin
      # - ${BITCOIN_DATA_DIR}:/bitcoin:ro
    environment:
      # Pass any environment variables to your app for configuration in the form:
      # VARIABLE_NAME: value
      #
      # Here are all the Umbrel provided variables that you can pass through to
      # your app to connect to Bitcoin Core, LND, Electrum and Tor:
      #
      # Bitcoin Core environment variables
      # $BITCOIN_NETWORK - Can be "mainnet", "testnet" or "regtest"
      # $BITCOIN_IP - Local IP of Bitcoin Core
      # $BITCOIN_P2P_PORT - P2P port
      # $BITCOIN_RPC_PORT - RPC port
      # $BITCOIN_RPC_USER - RPC username
      # $BITCOIN_RPC_PASS - RPC password
      # $BITCOIN_RPC_AUTH - RPC auth string

      # Bitcoin Core connection details
      SQUEAKNODE_BITCOIND_HOST: $BITCOIN_IP
      SQUEAKNODE_BITCOIND_PORT: $BITCOIN_RPC_PORT
      SQUEAKNODE_BITCOIND_USER: $BITCOIN_RPC_USER
      SQUEAKNODE_BITCOIND_PASS: $BITCOIN_RPC_PASS

      #
      # LND environment variables
      # $LND_IP - Local IP of LND
      # $LND_GRPC_PORT - gRPC Port of LND
      # $LND_REST_PORT - REST Port of LND

      # LND environment variables
      SQUEAKNODE_LND_TLS_CERT_PATH: "/lnd/tls.cert"
      SQUEAKNODE_LND_MACAROON_PATH: "/lnd/data/chain/bitcoin/$BITCOIN_NETWORK/admin.macaroon"
      SQUEAKNODE_LND_HOST: $LND_IP
      SQUEAKNODE_LND_GRPC_PORT: $LND_GRPC_PORT

      SQUEAKNODE_SQK_DIR_PATH: "/sqk"
      SQUEAKNODE_WEBADMIN_ENABLED: "true"
      SQUEAKNODE_WEBADMIN_USERNAME: "devuser"
      SQUEAKNODE_WEBADMIN_PASSWORD: "devpass"

      #
      # Electrum server environment variables
      # $ELECTRUM_IP - Local IP of Electrum server
      # $ELECTRUM_PORT - Port of Electrum server
      #
      # Tor proxy environment variables
      # $TOR_PROXY_IP - Local IP of Tor proxy
      # $TOR_PROXY_PORT - Port of Tor proxy
      #
      # App specific environment variables
      # $APP_HIDDEN_SERVICE - The address of the Tor hidden service your app will be exposed at
      SQUEAKNODE_NETWORK: "$BITCOIN_NETWORK"
      SQUEAKNODE_SQK_DIR_PATH: "sqk"
      SQUEAKNODE_PRICE_MSAT: 10
      SQUEAKNODE_SYNC_INTERVAL_S: 10

      DEBUG: "squeaknode:*"
  # If your app has more services, like a database container, you can define those
  # services below:
  # db:
  #   image: <docker-image>:<tag>
  #   ...
