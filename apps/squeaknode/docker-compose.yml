version: "3.7"

x-logging:
  &default-logging
  driver: journald
  options:
    tag: "umbrel-app {{.Name}}"

services:
  web:
    image: yzernik/squeaknode:v0.1.8@sha256:0a9a70bcd126ceaba5e640d0ea6e3d73b202bd4f728485242e53881f9fe86f78
    logging: *default-logging
    restart: on-failure
    stop_grace_period: 1m
    ports:
      - 8774:8774
      - 12994:12994
    volumes:
      - ${APP_DATA_DIR}/sqk:/sqk
      - ${LND_DATA_DIR}:/lnd:ro
    environment:
      # Bitcoin Core connection details
      SQUEAKNODE_BITCOIN_RPC_HOST: $BITCOIN_IP
      SQUEAKNODE_BITCOIN_RPC_PORT: $BITCOIN_RPC_PORT
      SQUEAKNODE_BITCOIN_RPC_USER: $BITCOIN_RPC_USER
      SQUEAKNODE_BITCOIN_RPC_PASS: $BITCOIN_RPC_PASS

      # LND environment variables
      SQUEAKNODE_LND_HOST: $LND_IP
      SQUEAKNODE_LND_RPC_PORT: $LND_GRPC_PORT
      SQUEAKNODE_LND_TLS_CERT_PATH: "/lnd/tls.cert"
      SQUEAKNODE_LND_MACAROON_PATH: "/lnd/data/chain/bitcoin/$BITCOIN_NETWORK/admin.macaroon"

      # App specific environment variables
      SQUEAKNODE_WEBADMIN_ENABLED: "true"
      SQUEAKNODE_WEBADMIN_USERNAME: "umbrel"
      SQUEAKNODE_WEBADMIN_PASSWORD: "moneyprintergobrrr"

      SQUEAKNODE_CORE_NETWORK: "$BITCOIN_NETWORK"
      SQUEAKNODE_CORE_SQK_DIR_PATH: "/sqk"

      DEBUG: "squeaknode:*"
